"use strict";(self.webpackChunkclickable_json=self.webpackChunkclickable_json||[]).push([[363],{"./src/ClickableJsonCrdt/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("./node_modules/react/index.js");const context=react.createContext(null),useJsonCrdt=()=>react.useContext(context);var style=__webpack_require__("./src/context/style.ts");class NodeRef{constructor(node,parent,step){this.node=node,this.parent=parent,this.step=step}}var Root=__webpack_require__("./src/Root/index.tsx"),context_focus=__webpack_require__("./src/context/focus.tsx"),json_crdt=__webpack_require__("./node_modules/json-joy/es2020/json-crdt/index.js"),lib=__webpack_require__("./node_modules/nano-theme/lib/index.js"),css=__webpack_require__("./src/css.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const PropertyLayout=_ref=>{let{property,formal,focused}=_ref;const theme=(0,lib.useTheme)(),style={color:theme.g(.1)};return focused&&(style.background=theme.bg,style.border=`1px solid ${theme.g(.9)}`,style.fontWeight="bold",style.margin="-3px",style.padding="2px"),property&&-1===property.indexOf(" ")||(style.background=theme.blue(.1)),(0,jsx_runtime.jsxs)(jsx_runtime.Fragment,{children:[(0,jsx_runtime.jsx)("span",{className:css.Cb,style,children:formal?JSON.stringify(property):property}),(0,jsx_runtime.jsx)("span",{className:css.ob,style:{color:theme.g(.5)},children:(0,jsx_runtime.jsx)("span",{children:":"})})]})};try{PropertyLayout.displayName="PropertyLayout",PropertyLayout.__docgenInfo={description:"",displayName:"PropertyLayout",props:{property:{defaultValue:null,description:"",name:"property",required:!0,type:{name:"string"}},formal:{defaultValue:null,description:"",name:"formal",required:!1,type:{name:"boolean"}},focused:{defaultValue:null,description:"",name:"focused",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/PropertyLayout/index.tsx#PropertyLayout"]={docgenInfo:PropertyLayout.__docgenInfo,name:"PropertyLayout",path:"src/PropertyLayout/index.tsx#PropertyLayout"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtProperty=_ref=>{let{node}=_ref;return node.parent&&"obj"===node.parent.node.name()?(0,jsx_runtime.jsx)(PropertyLayout,{property:node.step}):null};JsonCrdtProperty.displayName="JsonCrdtProperty";try{JsonCrdtProperty.displayName="JsonCrdtProperty",JsonCrdtProperty.__docgenInfo={description:"",displayName:"JsonCrdtProperty",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<JsonNode<unknown>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/JsonCrdtProperty.tsx#JsonCrdtProperty"]={docgenInfo:JsonCrdtProperty.__docgenInfo,name:"JsonCrdtProperty",path:"src/ClickableJsonCrdt/JsonCrdtProperty.tsx#JsonCrdtProperty"})}catch(__react_docgen_typescript_loader_error){}var FocusRegion=__webpack_require__("./src/FocusRegion/index.tsx");const id=node=>{const id=node.node.id;return id.sid+"."+id.time},blockClass=(0,lib.rule)({...lib.theme.font.mono,fz:"10px",lh:"9px",us:"none",pe:"none"}),TypeAndId=react.memo((_ref=>{let{node}=_ref;const theme=(0,lib.useTheme)(),{sid,time}=node.node.id;return(0,jsx_runtime.jsxs)("span",{className:blockClass,style:{color:theme.color.sem.blue[0]},children:[node.node.name(),(0,jsx_runtime.jsxs)("span",{style:{color:theme.g(0,.45),display:"block"},children:["..."+String(sid).slice(String(sid).length-4),(0,jsx_runtime.jsx)("span",{style:{color:theme.g(0,.7)},children:"."+time})]})]})}));try{TypeAndId.displayName="TypeAndId",TypeAndId.__docgenInfo={description:"",displayName:"TypeAndId",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<any>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/TypeAndId.tsx#TypeAndId"]={docgenInfo:TypeAndId.__docgenInfo,name:"TypeAndId",path:"src/ClickableJsonCrdt/TypeAndId.tsx#TypeAndId"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtRegion=_ref=>{let{node,children}=_ref;const{compact}=(0,style.y)(),{focused,focus,pointed,point}=(0,context_focus.KK)(),nodeId=id(node),isFocused=focused===nodeId,aside=isFocused?(0,jsx_runtime.jsx)("span",{style:{display:"inline-block",margin:"-4px 0 0"},children:(0,jsx_runtime.jsx)(TypeAndId,{node})}):void 0;return(0,jsx_runtime.jsx)(FocusRegion._,{pointed:pointed===nodeId,focused:isFocused,compact,aside,onClick:e=>{e.preventDefault(),e.stopPropagation(),focus(nodeId)},onMouseMove:e=>{e.stopPropagation(),pointed!==nodeId&&point(nodeId)},onMouseEnter:e=>{e.preventDefault(),e.stopPropagation(),point(nodeId)},onMouseLeave:()=>{point("")},children})};JsonCrdtRegion.displayName="JsonCrdtRegion";try{JsonCrdtRegion.displayName="JsonCrdtRegion",JsonCrdtRegion.__docgenInfo={description:"",displayName:"JsonCrdtRegion",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<any>"}},aside:{defaultValue:null,description:"",name:"aside",required:!1,type:{name:"ReactNode"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/JsonCrdtRegion.tsx#JsonCrdtRegion"]={docgenInfo:JsonCrdtRegion.__docgenInfo,name:"JsonCrdtRegion",path:"src/ClickableJsonCrdt/JsonCrdtRegion.tsx#JsonCrdtRegion"})}catch(__react_docgen_typescript_loader_error){}var utils=__webpack_require__("./src/ClickableJson/utils.tsx");const blue=lib.theme.color.sem.blue[0],JsonAtom=props=>{const{value,onClick}=props,theme=(0,lib.useTheme)();let color=theme.g(.2),formatted="∅";return Array.isArray(value)?(color=blue,formatted="["+value.length+"]"):value&&"object"==typeof value?(color=blue,formatted="{"+Object.keys(value).length+"}"):(color=(0,utils.pG)(!theme.isLight,value)??color,formatted=react.useMemo((()=>null===value?"null":"boolean"==typeof value?value?"true":"false":"string"==typeof value?JSON.stringify(value):String(value)),[value,theme])),(0,jsx_runtime.jsx)("span",{style:{color},onClick,children:formatted})};JsonAtom.displayName="JsonAtom";try{JsonAtom.displayName="JsonAtom",JsonAtom.__docgenInfo={description:"",displayName:"JsonAtom",props:{value:{defaultValue:null,description:"",name:"value",required:!0,type:{name:"unknown"}},onClick:{defaultValue:null,description:"",name:"onClick",required:!1,type:{name:"MouseEventHandler<Element>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/JsonAtom/JsonAtom.tsx#JsonAtom"]={docgenInfo:JsonAtom.__docgenInfo,name:"JsonAtom",path:"src/JsonAtom/JsonAtom.tsx#JsonAtom"})}catch(__react_docgen_typescript_loader_error){}var ClickableJson=__webpack_require__("./src/ClickableJson/index.tsx");const JsonCrdtConNode=_ref=>{let{node}=_ref;const{formal}=(0,style.y)(),[viewJson,setViewJson]=react.useState(!1),view=node.node.view();return(0,jsx_runtime.jsxs)(JsonCrdtRegion,{node,children:[(0,jsx_runtime.jsx)(JsonCrdtProperty,{node}),viewJson?(0,jsx_runtime.jsx)("span",{style:{display:"inline-block",verticalAlign:"top",margin:"-1px"},children:(0,jsx_runtime.jsx)(ClickableJson.H,{readonly:!0,compact:!0,collapsed:!0,noCollapseToggles:!0,pfx:id(node),doc:node.node.view()})}):(0,jsx_runtime.jsx)(JsonAtom,{value:node.node.view(),onClick:()=>{view&&"object"==typeof view&&setViewJson(!viewJson)}}),!!formal&&","]})};JsonCrdtConNode.displayName="JsonCrdtConNode";try{JsonCrdtConNode.displayName="JsonCrdtConNode",JsonCrdtConNode.__docgenInfo={description:"",displayName:"JsonCrdtConNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<ConNode<unknown>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtConNode.tsx#JsonCrdtConNode"]={docgenInfo:JsonCrdtConNode.__docgenInfo,name:"JsonCrdtConNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtConNode.tsx#JsonCrdtConNode"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtValNode=()=>(0,jsx_runtime.jsx)("span",{children:"val..."});JsonCrdtValNode.displayName="JsonCrdtValNode";try{JsonCrdtValNode.displayName="JsonCrdtValNode",JsonCrdtValNode.__docgenInfo={description:"",displayName:"JsonCrdtValNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<ValNode<JsonNode<unknown>>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtValNode.tsx#JsonCrdtValNode"]={docgenInfo:JsonCrdtValNode.__docgenInfo,name:"JsonCrdtValNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtValNode.tsx#JsonCrdtValNode"})}catch(__react_docgen_typescript_loader_error){}var ObjectLayout=__webpack_require__("./src/ObjectLayout/index.tsx");const JsonCrdtObjNode=_ref=>{let{node}=_ref;const{render}=useJsonCrdt(),entries=[];return node.node.nodes(((child,key)=>{entries.push((0,jsx_runtime.jsx)("span",{className:css.jv,children:render(new NodeRef(child,node,key))},key))})),(0,jsx_runtime.jsx)(JsonCrdtRegion,{node,children:(0,jsx_runtime.jsx)(ObjectLayout.D,{property:(0,jsx_runtime.jsx)(JsonCrdtProperty,{node}),children:entries})})};JsonCrdtObjNode.displayName="JsonCrdtObjNode";try{JsonCrdtObjNode.displayName="JsonCrdtObjNode",JsonCrdtObjNode.__docgenInfo={description:"",displayName:"JsonCrdtObjNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<ObjNode<Record<string, JsonNode<unknown>>>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtObjNode.tsx#JsonCrdtObjNode"]={docgenInfo:JsonCrdtObjNode.__docgenInfo,name:"JsonCrdtObjNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtObjNode.tsx#JsonCrdtObjNode"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtVecNode=_ref=>{let{node}=_ref;const{render}=useJsonCrdt(),entries=[];let i=0;return node.node.children((child=>{entries.push((0,jsx_runtime.jsx)("span",{className:css.jv,children:render(new NodeRef(child,node,String(i)))},child.id.sid+"."+child.id.time)),i++})),(0,jsx_runtime.jsx)(JsonCrdtRegion,{node,children:(0,jsx_runtime.jsx)(ObjectLayout.D,{property:(0,jsx_runtime.jsx)(JsonCrdtProperty,{node}),brackets:["[","]"],header:(0,jsx_runtime.jsx)("span",{style:{opacity:.5,display:"inline-block",margin:"0.275em 0 0 -0.3em"},children:"→"}),children:entries})})};JsonCrdtVecNode.displayName="JsonCrdtVecNode";try{JsonCrdtVecNode.displayName="JsonCrdtVecNode",JsonCrdtVecNode.__docgenInfo={description:"",displayName:"JsonCrdtVecNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<VecNode<JsonNode<unknown>[]>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtVecNode.tsx#JsonCrdtVecNode"]={docgenInfo:JsonCrdtVecNode.__docgenInfo,name:"JsonCrdtVecNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtVecNode.tsx#JsonCrdtVecNode"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtArrNode=_ref=>{let{node}=_ref;const{render}=useJsonCrdt(),entries=[];let i=0;return node.node.children((child=>{entries.push((0,jsx_runtime.jsx)("span",{className:css.jv,children:render(new NodeRef(child,node,String(i)))},child.id.sid+"."+child.id.time)),i++})),(0,jsx_runtime.jsx)(JsonCrdtRegion,{node,children:(0,jsx_runtime.jsx)(ObjectLayout.D,{property:(0,jsx_runtime.jsx)(JsonCrdtProperty,{node}),brackets:["[","]"],children:entries})})};JsonCrdtArrNode.displayName="JsonCrdtArrNode";try{JsonCrdtArrNode.displayName="JsonCrdtArrNode",JsonCrdtArrNode.__docgenInfo={description:"",displayName:"JsonCrdtArrNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<ArrNode<JsonNode<unknown>>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtArrNode.tsx#JsonCrdtArrNode"]={docgenInfo:JsonCrdtArrNode.__docgenInfo,name:"JsonCrdtArrNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtArrNode.tsx#JsonCrdtArrNode"})}catch(__react_docgen_typescript_loader_error){}const JsonCrdtStrNode=_ref=>{let{node}=_ref;const{formal}=(0,style.y)();return(0,jsx_runtime.jsxs)(JsonCrdtRegion,{node,children:[(0,jsx_runtime.jsx)(JsonCrdtProperty,{node}),(0,jsx_runtime.jsx)(JsonAtom,{value:node.node.view()}),!!formal&&","]})};JsonCrdtStrNode.displayName="JsonCrdtStrNode";try{JsonCrdtStrNode.displayName="JsonCrdtStrNode",JsonCrdtStrNode.__docgenInfo={description:"",displayName:"JsonCrdtStrNode",props:{node:{defaultValue:null,description:"",name:"node",required:!0,type:{name:"NodeRef<StrNode<string>>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/nodes/JsonCrdtStrNode.tsx#JsonCrdtStrNode"]={docgenInfo:JsonCrdtStrNode.__docgenInfo,name:"JsonCrdtStrNode",path:"src/ClickableJsonCrdt/nodes/JsonCrdtStrNode.tsx#JsonCrdtStrNode"})}catch(__react_docgen_typescript_loader_error){}const render=node=>node.node instanceof json_crdt.ConNode?(0,jsx_runtime.jsx)(JsonCrdtConNode,{node}):node.node instanceof json_crdt.ValNode?(0,jsx_runtime.jsx)(JsonCrdtValNode,{node}):node.node instanceof json_crdt.ObjNode?(0,jsx_runtime.jsx)(JsonCrdtObjNode,{node}):node.node instanceof json_crdt.StrNode?(0,jsx_runtime.jsx)(JsonCrdtStrNode,{node}):node.node instanceof json_crdt.VecNode?(0,jsx_runtime.jsx)(JsonCrdtVecNode,{node}):node.node instanceof json_crdt.ArrNode?(0,jsx_runtime.jsx)(JsonCrdtArrNode,{node}):"∅",ClickableJsonCrdt=props=>{const{model,compact,readonly}=props,node=react.useMemo((()=>new NodeRef(model.root.child(),null,"")),[model]);return(0,jsx_runtime.jsx)(style.D.Provider,{value:{compact,readonly},children:(0,jsx_runtime.jsx)(context.Provider,{value:{model,render},children:(0,jsx_runtime.jsx)(context_focus.eQ,{children:(0,jsx_runtime.jsx)(Root.f,{children:render(node)})})})})};ClickableJsonCrdt.displayName="ClickableJsonCrdt";try{ClickableJsonCrdt.displayName="ClickableJsonCrdt",ClickableJsonCrdt.__docgenInfo={description:"",displayName:"ClickableJsonCrdt",props:{model:{defaultValue:null,description:"The JSON CRDT model to display.",name:"model",required:!0,type:{name:"Model<JsonNode<unknown>>"}},readonly:{defaultValue:{value:"false"},description:"If true, the JSON is not editable. Useful for displaying JSON.",name:"readonly",required:!1,type:{name:"boolean"}},formal:{defaultValue:{value:"false"},description:"Print the JSON in a more formal way. Adds quotes to keys and string values.\nAdds commas after each property.\n\nWorks only in readonly mode.",name:"formal",required:!1,type:{name:"boolean"}},keepOrder:{defaultValue:{value:"false"},description:"Keep the order of properties in objects. By default the properties are\nsorted alphabetically.",name:"keepOrder",required:!1,type:{name:"boolean"}},fontSize:{defaultValue:{value:"13.4px"},description:"Font size of the JSON.",name:"fontSize",required:!1,type:{name:"string"}},compact:{defaultValue:{value:"false"},description:"If true, the JSON is printed in a compact way. Reduces spacing between\nelements.",name:"compact",required:!1,type:{name:"boolean"}},collapsed:{defaultValue:{value:"false"},description:"If true, the JSON starts collapsed, but can be expanded by clicking on it.",name:"collapsed",required:!1,type:{name:"boolean"}},noCollapseToggles:{defaultValue:{value:"false"},description:"Whether to show +/- buttons to expand/collapse objects and arrays.",name:"noCollapseToggles",required:!1,type:{name:"boolean"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/ClickableJsonCrdt/index.tsx#ClickableJsonCrdt"]={docgenInfo:ClickableJsonCrdt.__docgenInfo,name:"ClickableJsonCrdt",path:"src/ClickableJsonCrdt/index.tsx#ClickableJsonCrdt"})}catch(__react_docgen_typescript_loader_error){}var json_crdt_patch=__webpack_require__("./node_modules/json-joy/es2020/json-crdt-patch/index.js");const index_stories={title:"ClickableJsonCrdt",component:ClickableJsonCrdt,parameters:{layout:"centered"},tags:["autodocs"],argTypes:{}},model=json_crdt.Model.withLogicalClock();model.api.root({foo:json_crdt_patch.s.con([123,[null]]),bar:!0,baz:{x:1},qux:json_crdt_patch.s.vec(json_crdt_patch.s.con(1),json_crdt_patch.s.con(-2),json_crdt_patch.s.con("three"),json_crdt_patch.s.con({four:4})),arr:[json_crdt_patch.s.con(0),"hello world"]}),console.log(model+"");const Primary={render:()=>(0,jsx_runtime.jsx)("div",{style:{padding:"32px 64px"},children:(0,jsx_runtime.jsx)(ClickableJsonCrdt,{model})}),parameters:{layout:"fullscreen"}};Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  render: () => <div style={{\n    padding: '32px 64px'\n  }}>\n      <ClickableJsonCrdt model={model} />\n    </div>,\n  parameters: {\n    layout: 'fullscreen'\n  }\n}",...Primary.parameters?.docs?.source}}};const __namedExportsOrder=["Primary"]}}]);